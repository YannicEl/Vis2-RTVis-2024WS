var Ot=Object.defineProperty;var gt=f=>{throw TypeError(f)};var Vt=(f,w,A)=>w in f?Ot(f,w,{enumerable:!0,configurable:!0,writable:!0,value:A}):f[w]=A;var N=(f,w,A)=>Vt(f,typeof w!="symbol"?w+"":w,A),zt=(f,w,A)=>w.has(f)||gt("Cannot "+A);var X=(f,w,A)=>(zt(f,w,"read from private field"),A?A.call(f):w.get(f)),fn=(f,w,A)=>w.has(f)?gt("Cannot add the same private member more than once"):w instanceof WeakSet?w.add(f):w.set(f,A),on=(f,w,A,P)=>(zt(f,w,"write to private field"),P?P.call(f,A):w.set(f,A),A);function _t(f,w){return class extends f{constructor(...A){super(...A),w(this)}}}const Et=_t(Array,f=>f.fill(0));let V=1e-6;function Gt(f){function w(n=0,r=0){const t=new f(2);return n!==void 0&&(t[0]=n,r!==void 0&&(t[1]=r)),t}const A=w;function P(n,r,t){const e=t??new f(2);return e[0]=n,e[1]=r,e}function U(n,r){const t=r??new f(2);return t[0]=Math.ceil(n[0]),t[1]=Math.ceil(n[1]),t}function B(n,r){const t=r??new f(2);return t[0]=Math.floor(n[0]),t[1]=Math.floor(n[1]),t}function G(n,r){const t=r??new f(2);return t[0]=Math.round(n[0]),t[1]=Math.round(n[1]),t}function O(n,r=0,t=1,e){const u=e??new f(2);return u[0]=Math.min(t,Math.max(r,n[0])),u[1]=Math.min(t,Math.max(r,n[1])),u}function L(n,r,t){const e=t??new f(2);return e[0]=n[0]+r[0],e[1]=n[1]+r[1],e}function W(n,r,t,e){const u=e??new f(2);return u[0]=n[0]+r[0]*t,u[1]=n[1]+r[1]*t,u}function Q(n,r){const t=n[0],e=n[1],u=r[0],p=r[1],g=Math.sqrt(t*t+e*e),i=Math.sqrt(u*u+p*p),a=g*i,M=a&&gn(n,r)/a;return Math.acos(M)}function j(n,r,t){const e=t??new f(2);return e[0]=n[0]-r[0],e[1]=n[1]-r[1],e}const tn=j;function Z(n,r){return Math.abs(n[0]-r[0])<V&&Math.abs(n[1]-r[1])<V}function b(n,r){return n[0]===r[0]&&n[1]===r[1]}function sn(n,r,t,e){const u=e??new f(2);return u[0]=n[0]+t*(r[0]-n[0]),u[1]=n[1]+t*(r[1]-n[1]),u}function $(n,r,t,e){const u=e??new f(2);return u[0]=n[0]+t[0]*(r[0]-n[0]),u[1]=n[1]+t[1]*(r[1]-n[1]),u}function R(n,r,t){const e=t??new f(2);return e[0]=Math.max(n[0],r[0]),e[1]=Math.max(n[1],r[1]),e}function J(n,r,t){const e=t??new f(2);return e[0]=Math.min(n[0],r[0]),e[1]=Math.min(n[1],r[1]),e}function m(n,r,t){const e=t??new f(2);return e[0]=n[0]*r,e[1]=n[1]*r,e}const cn=m;function H(n,r,t){const e=t??new f(2);return e[0]=n[0]/r,e[1]=n[1]/r,e}function rn(n,r){const t=r??new f(2);return t[0]=1/n[0],t[1]=1/n[1],t}const en=rn;function hn(n,r,t){const e=t??new f(3),u=n[0]*r[1]-n[1]*r[0];return e[0]=0,e[1]=0,e[2]=u,e}function gn(n,r){return n[0]*r[0]+n[1]*r[1]}function wn(n){const r=n[0],t=n[1];return Math.sqrt(r*r+t*t)}const _n=wn;function F(n){const r=n[0],t=n[1];return r*r+t*t}const k=F;function E(n,r){const t=n[0]-r[0],e=n[1]-r[1];return Math.sqrt(t*t+e*e)}const Fn=E;function zn(n,r){const t=n[0]-r[0],e=n[1]-r[1];return t*t+e*e}const Yn=zn;function An(n,r){const t=r??new f(2),e=n[0],u=n[1],p=Math.sqrt(e*e+u*u);return p>1e-5?(t[0]=e/p,t[1]=u/p):(t[0]=0,t[1]=0),t}function Xn(n,r){const t=r??new f(2);return t[0]=-n[0],t[1]=-n[1],t}function C(n,r){const t=r??new f(2);return t[0]=n[0],t[1]=n[1],t}const $n=C;function Sn(n,r,t){const e=t??new f(2);return e[0]=n[0]*r[0],e[1]=n[1]*r[1],e}const Wn=Sn;function Tn(n,r,t){const e=t??new f(2);return e[0]=n[0]/r[0],e[1]=n[1]/r[1],e}const En=Tn;function Bn(n=1,r){const t=r??new f(2),e=Math.random()*2*Math.PI;return t[0]=Math.cos(e)*n,t[1]=Math.sin(e)*n,t}function o(n){const r=n??new f(2);return r[0]=0,r[1]=0,r}function l(n,r,t){const e=t??new f(2),u=n[0],p=n[1];return e[0]=u*r[0]+p*r[4]+r[12],e[1]=u*r[1]+p*r[5]+r[13],e}function s(n,r,t){const e=t??new f(2),u=n[0],p=n[1];return e[0]=r[0]*u+r[4]*p+r[8],e[1]=r[1]*u+r[5]*p+r[9],e}function c(n,r,t,e){const u=e??new f(2),p=n[0]-r[0],g=n[1]-r[1],i=Math.sin(t),a=Math.cos(t);return u[0]=p*a-g*i+r[0],u[1]=p*i+g*a+r[1],u}function h(n,r,t){const e=t??new f(2);return An(n,e),m(e,r,e)}function d(n,r,t){const e=t??new f(2);return wn(n)>r?h(n,r,e):C(n,e)}function y(n,r,t){const e=t??new f(2);return sn(n,r,.5,e)}return{create:w,fromValues:A,set:P,ceil:U,floor:B,round:G,clamp:O,add:L,addScaled:W,angle:Q,subtract:j,sub:tn,equalsApproximately:Z,equals:b,lerp:sn,lerpV:$,max:R,min:J,mulScalar:m,scale:cn,divScalar:H,inverse:rn,invert:en,cross:hn,dot:gn,length:wn,len:_n,lengthSq:F,lenSq:k,distance:E,dist:Fn,distanceSq:zn,distSq:Yn,normalize:An,negate:Xn,copy:C,clone:$n,multiply:Sn,mul:Wn,divide:Tn,div:En,random:Bn,zero:o,transformMat4:l,transformMat3:s,rotate:c,setLength:h,truncate:d,midpoint:y}}const At=new Map;function Bt(f){let w=At.get(f);return w||(w=Gt(f),At.set(f,w)),w}function Ft(f){function w(i,a,M){const x=new f(3);return i!==void 0&&(x[0]=i,a!==void 0&&(x[1]=a,M!==void 0&&(x[2]=M))),x}const A=w;function P(i,a,M,x){const D=x??new f(3);return D[0]=i,D[1]=a,D[2]=M,D}function U(i,a){const M=a??new f(3);return M[0]=Math.ceil(i[0]),M[1]=Math.ceil(i[1]),M[2]=Math.ceil(i[2]),M}function B(i,a){const M=a??new f(3);return M[0]=Math.floor(i[0]),M[1]=Math.floor(i[1]),M[2]=Math.floor(i[2]),M}function G(i,a){const M=a??new f(3);return M[0]=Math.round(i[0]),M[1]=Math.round(i[1]),M[2]=Math.round(i[2]),M}function O(i,a=0,M=1,x){const D=x??new f(3);return D[0]=Math.min(M,Math.max(a,i[0])),D[1]=Math.min(M,Math.max(a,i[1])),D[2]=Math.min(M,Math.max(a,i[2])),D}function L(i,a,M){const x=M??new f(3);return x[0]=i[0]+a[0],x[1]=i[1]+a[1],x[2]=i[2]+a[2],x}function W(i,a,M,x){const D=x??new f(3);return D[0]=i[0]+a[0]*M,D[1]=i[1]+a[1]*M,D[2]=i[2]+a[2]*M,D}function Q(i,a){const M=i[0],x=i[1],D=i[2],z=a[0],q=a[1],S=a[2],v=Math.sqrt(M*M+x*x+D*D),I=Math.sqrt(z*z+q*q+S*S),T=v*I,_=T&&gn(i,a)/T;return Math.acos(_)}function j(i,a,M){const x=M??new f(3);return x[0]=i[0]-a[0],x[1]=i[1]-a[1],x[2]=i[2]-a[2],x}const tn=j;function Z(i,a){return Math.abs(i[0]-a[0])<V&&Math.abs(i[1]-a[1])<V&&Math.abs(i[2]-a[2])<V}function b(i,a){return i[0]===a[0]&&i[1]===a[1]&&i[2]===a[2]}function sn(i,a,M,x){const D=x??new f(3);return D[0]=i[0]+M*(a[0]-i[0]),D[1]=i[1]+M*(a[1]-i[1]),D[2]=i[2]+M*(a[2]-i[2]),D}function $(i,a,M,x){const D=x??new f(3);return D[0]=i[0]+M[0]*(a[0]-i[0]),D[1]=i[1]+M[1]*(a[1]-i[1]),D[2]=i[2]+M[2]*(a[2]-i[2]),D}function R(i,a,M){const x=M??new f(3);return x[0]=Math.max(i[0],a[0]),x[1]=Math.max(i[1],a[1]),x[2]=Math.max(i[2],a[2]),x}function J(i,a,M){const x=M??new f(3);return x[0]=Math.min(i[0],a[0]),x[1]=Math.min(i[1],a[1]),x[2]=Math.min(i[2],a[2]),x}function m(i,a,M){const x=M??new f(3);return x[0]=i[0]*a,x[1]=i[1]*a,x[2]=i[2]*a,x}const cn=m;function H(i,a,M){const x=M??new f(3);return x[0]=i[0]/a,x[1]=i[1]/a,x[2]=i[2]/a,x}function rn(i,a){const M=a??new f(3);return M[0]=1/i[0],M[1]=1/i[1],M[2]=1/i[2],M}const en=rn;function hn(i,a,M){const x=M??new f(3),D=i[2]*a[0]-i[0]*a[2],z=i[0]*a[1]-i[1]*a[0];return x[0]=i[1]*a[2]-i[2]*a[1],x[1]=D,x[2]=z,x}function gn(i,a){return i[0]*a[0]+i[1]*a[1]+i[2]*a[2]}function wn(i){const a=i[0],M=i[1],x=i[2];return Math.sqrt(a*a+M*M+x*x)}const _n=wn;function F(i){const a=i[0],M=i[1],x=i[2];return a*a+M*M+x*x}const k=F;function E(i,a){const M=i[0]-a[0],x=i[1]-a[1],D=i[2]-a[2];return Math.sqrt(M*M+x*x+D*D)}const Fn=E;function zn(i,a){const M=i[0]-a[0],x=i[1]-a[1],D=i[2]-a[2];return M*M+x*x+D*D}const Yn=zn;function An(i,a){const M=a??new f(3),x=i[0],D=i[1],z=i[2],q=Math.sqrt(x*x+D*D+z*z);return q>1e-5?(M[0]=x/q,M[1]=D/q,M[2]=z/q):(M[0]=0,M[1]=0,M[2]=0),M}function Xn(i,a){const M=a??new f(3);return M[0]=-i[0],M[1]=-i[1],M[2]=-i[2],M}function C(i,a){const M=a??new f(3);return M[0]=i[0],M[1]=i[1],M[2]=i[2],M}const $n=C;function Sn(i,a,M){const x=M??new f(3);return x[0]=i[0]*a[0],x[1]=i[1]*a[1],x[2]=i[2]*a[2],x}const Wn=Sn;function Tn(i,a,M){const x=M??new f(3);return x[0]=i[0]/a[0],x[1]=i[1]/a[1],x[2]=i[2]/a[2],x}const En=Tn;function Bn(i=1,a){const M=a??new f(3),x=Math.random()*2*Math.PI,D=Math.random()*2-1,z=Math.sqrt(1-D*D)*i;return M[0]=Math.cos(x)*z,M[1]=Math.sin(x)*z,M[2]=D*i,M}function o(i){const a=i??new f(3);return a[0]=0,a[1]=0,a[2]=0,a}function l(i,a,M){const x=M??new f(3),D=i[0],z=i[1],q=i[2],S=a[3]*D+a[7]*z+a[11]*q+a[15]||1;return x[0]=(a[0]*D+a[4]*z+a[8]*q+a[12])/S,x[1]=(a[1]*D+a[5]*z+a[9]*q+a[13])/S,x[2]=(a[2]*D+a[6]*z+a[10]*q+a[14])/S,x}function s(i,a,M){const x=M??new f(3),D=i[0],z=i[1],q=i[2];return x[0]=D*a[0*4+0]+z*a[1*4+0]+q*a[2*4+0],x[1]=D*a[0*4+1]+z*a[1*4+1]+q*a[2*4+1],x[2]=D*a[0*4+2]+z*a[1*4+2]+q*a[2*4+2],x}function c(i,a,M){const x=M??new f(3),D=i[0],z=i[1],q=i[2];return x[0]=D*a[0]+z*a[4]+q*a[8],x[1]=D*a[1]+z*a[5]+q*a[9],x[2]=D*a[2]+z*a[6]+q*a[10],x}function h(i,a,M){const x=M??new f(3),D=a[0],z=a[1],q=a[2],S=a[3]*2,v=i[0],I=i[1],T=i[2],_=z*T-q*I,Y=q*v-D*T,nn=D*I-z*v;return x[0]=v+_*S+(z*nn-q*Y)*2,x[1]=I+Y*S+(q*_-D*nn)*2,x[2]=T+nn*S+(D*Y-z*_)*2,x}function d(i,a){const M=a??new f(3);return M[0]=i[12],M[1]=i[13],M[2]=i[14],M}function y(i,a,M){const x=M??new f(3),D=a*4;return x[0]=i[D+0],x[1]=i[D+1],x[2]=i[D+2],x}function n(i,a){const M=a??new f(3),x=i[0],D=i[1],z=i[2],q=i[4],S=i[5],v=i[6],I=i[8],T=i[9],_=i[10];return M[0]=Math.sqrt(x*x+D*D+z*z),M[1]=Math.sqrt(q*q+S*S+v*v),M[2]=Math.sqrt(I*I+T*T+_*_),M}function r(i,a,M,x){const D=x??new f(3),z=[],q=[];return z[0]=i[0]-a[0],z[1]=i[1]-a[1],z[2]=i[2]-a[2],q[0]=z[0],q[1]=z[1]*Math.cos(M)-z[2]*Math.sin(M),q[2]=z[1]*Math.sin(M)+z[2]*Math.cos(M),D[0]=q[0]+a[0],D[1]=q[1]+a[1],D[2]=q[2]+a[2],D}function t(i,a,M,x){const D=x??new f(3),z=[],q=[];return z[0]=i[0]-a[0],z[1]=i[1]-a[1],z[2]=i[2]-a[2],q[0]=z[2]*Math.sin(M)+z[0]*Math.cos(M),q[1]=z[1],q[2]=z[2]*Math.cos(M)-z[0]*Math.sin(M),D[0]=q[0]+a[0],D[1]=q[1]+a[1],D[2]=q[2]+a[2],D}function e(i,a,M,x){const D=x??new f(3),z=[],q=[];return z[0]=i[0]-a[0],z[1]=i[1]-a[1],z[2]=i[2]-a[2],q[0]=z[0]*Math.cos(M)-z[1]*Math.sin(M),q[1]=z[0]*Math.sin(M)+z[1]*Math.cos(M),q[2]=z[2],D[0]=q[0]+a[0],D[1]=q[1]+a[1],D[2]=q[2]+a[2],D}function u(i,a,M){const x=M??new f(3);return An(i,x),m(x,a,x)}function p(i,a,M){const x=M??new f(3);return wn(i)>a?u(i,a,x):C(i,x)}function g(i,a,M){const x=M??new f(3);return sn(i,a,.5,x)}return{create:w,fromValues:A,set:P,ceil:U,floor:B,round:G,clamp:O,add:L,addScaled:W,angle:Q,subtract:j,sub:tn,equalsApproximately:Z,equals:b,lerp:sn,lerpV:$,max:R,min:J,mulScalar:m,scale:cn,divScalar:H,inverse:rn,invert:en,cross:hn,dot:gn,length:wn,len:_n,lengthSq:F,lenSq:k,distance:E,dist:Fn,distanceSq:zn,distSq:Yn,normalize:An,negate:Xn,copy:C,clone:$n,multiply:Sn,mul:Wn,divide:Tn,div:En,random:Bn,zero:o,transformMat4:l,transformMat4Upper3x3:s,transformMat3:c,transformQuat:h,getTranslation:d,getAxis:y,getScaling:n,rotateX:r,rotateY:t,rotateZ:e,setLength:u,truncate:p,midpoint:g}}const qt=new Map;function lt(f){let w=qt.get(f);return w||(w=Ft(f),qt.set(f,w)),w}function Yt(f){const w=Bt(f),A=lt(f);function P(o,l,s,c,h,d,y,n,r){const t=new f(12);return t[3]=0,t[7]=0,t[11]=0,o!==void 0&&(t[0]=o,l!==void 0&&(t[1]=l,s!==void 0&&(t[2]=s,c!==void 0&&(t[4]=c,h!==void 0&&(t[5]=h,d!==void 0&&(t[6]=d,y!==void 0&&(t[8]=y,n!==void 0&&(t[9]=n,r!==void 0&&(t[10]=r))))))))),t}function U(o,l,s,c,h,d,y,n,r,t){const e=t??new f(12);return e[0]=o,e[1]=l,e[2]=s,e[3]=0,e[4]=c,e[5]=h,e[6]=d,e[7]=0,e[8]=y,e[9]=n,e[10]=r,e[11]=0,e}function B(o,l){const s=l??new f(12);return s[0]=o[0],s[1]=o[1],s[2]=o[2],s[3]=0,s[4]=o[4],s[5]=o[5],s[6]=o[6],s[7]=0,s[8]=o[8],s[9]=o[9],s[10]=o[10],s[11]=0,s}function G(o,l){const s=l??new f(12),c=o[0],h=o[1],d=o[2],y=o[3],n=c+c,r=h+h,t=d+d,e=c*n,u=h*n,p=h*r,g=d*n,i=d*r,a=d*t,M=y*n,x=y*r,D=y*t;return s[0]=1-p-a,s[1]=u+D,s[2]=g-x,s[3]=0,s[4]=u-D,s[5]=1-e-a,s[6]=i+M,s[7]=0,s[8]=g+x,s[9]=i-M,s[10]=1-e-p,s[11]=0,s}function O(o,l){const s=l??new f(12);return s[0]=-o[0],s[1]=-o[1],s[2]=-o[2],s[4]=-o[4],s[5]=-o[5],s[6]=-o[6],s[8]=-o[8],s[9]=-o[9],s[10]=-o[10],s}function L(o,l){const s=l??new f(12);return s[0]=o[0],s[1]=o[1],s[2]=o[2],s[4]=o[4],s[5]=o[5],s[6]=o[6],s[8]=o[8],s[9]=o[9],s[10]=o[10],s}const W=L;function Q(o,l){return Math.abs(o[0]-l[0])<V&&Math.abs(o[1]-l[1])<V&&Math.abs(o[2]-l[2])<V&&Math.abs(o[4]-l[4])<V&&Math.abs(o[5]-l[5])<V&&Math.abs(o[6]-l[6])<V&&Math.abs(o[8]-l[8])<V&&Math.abs(o[9]-l[9])<V&&Math.abs(o[10]-l[10])<V}function j(o,l){return o[0]===l[0]&&o[1]===l[1]&&o[2]===l[2]&&o[4]===l[4]&&o[5]===l[5]&&o[6]===l[6]&&o[8]===l[8]&&o[9]===l[9]&&o[10]===l[10]}function tn(o){const l=o??new f(12);return l[0]=1,l[1]=0,l[2]=0,l[4]=0,l[5]=1,l[6]=0,l[8]=0,l[9]=0,l[10]=1,l}function Z(o,l){const s=l??new f(12);if(s===o){let p;return p=o[1],o[1]=o[4],o[4]=p,p=o[2],o[2]=o[8],o[8]=p,p=o[6],o[6]=o[9],o[9]=p,s}const c=o[0*4+0],h=o[0*4+1],d=o[0*4+2],y=o[1*4+0],n=o[1*4+1],r=o[1*4+2],t=o[2*4+0],e=o[2*4+1],u=o[2*4+2];return s[0]=c,s[1]=y,s[2]=t,s[4]=h,s[5]=n,s[6]=e,s[8]=d,s[9]=r,s[10]=u,s}function b(o,l){const s=l??new f(12),c=o[0*4+0],h=o[0*4+1],d=o[0*4+2],y=o[1*4+0],n=o[1*4+1],r=o[1*4+2],t=o[2*4+0],e=o[2*4+1],u=o[2*4+2],p=u*n-r*e,g=-u*y+r*t,i=e*y-n*t,a=1/(c*p+h*g+d*i);return s[0]=p*a,s[1]=(-u*h+d*e)*a,s[2]=(r*h-d*n)*a,s[4]=g*a,s[5]=(u*c-d*t)*a,s[6]=(-r*c+d*y)*a,s[8]=i*a,s[9]=(-e*c+h*t)*a,s[10]=(n*c-h*y)*a,s}function sn(o){const l=o[0],s=o[0*4+1],c=o[0*4+2],h=o[1*4+0],d=o[1*4+1],y=o[1*4+2],n=o[2*4+0],r=o[2*4+1],t=o[2*4+2];return l*(d*t-r*y)-h*(s*t-r*c)+n*(s*y-d*c)}const $=b;function R(o,l,s){const c=s??new f(12),h=o[0],d=o[1],y=o[2],n=o[4],r=o[5],t=o[6],e=o[8],u=o[9],p=o[10],g=l[0],i=l[1],a=l[2],M=l[4],x=l[5],D=l[6],z=l[8],q=l[9],S=l[10];return c[0]=h*g+n*i+e*a,c[1]=d*g+r*i+u*a,c[2]=y*g+t*i+p*a,c[4]=h*M+n*x+e*D,c[5]=d*M+r*x+u*D,c[6]=y*M+t*x+p*D,c[8]=h*z+n*q+e*S,c[9]=d*z+r*q+u*S,c[10]=y*z+t*q+p*S,c}const J=R;function m(o,l,s){const c=s??tn();return o!==c&&(c[0]=o[0],c[1]=o[1],c[2]=o[2],c[4]=o[4],c[5]=o[5],c[6]=o[6]),c[8]=l[0],c[9]=l[1],c[10]=1,c}function cn(o,l){const s=l??w.create();return s[0]=o[8],s[1]=o[9],s}function H(o,l,s){const c=s??w.create(),h=l*4;return c[0]=o[h+0],c[1]=o[h+1],c}function rn(o,l,s,c){const h=c===o?o:L(o,c),d=s*4;return h[d+0]=l[0],h[d+1]=l[1],h}function en(o,l){const s=l??w.create(),c=o[0],h=o[1],d=o[4],y=o[5];return s[0]=Math.sqrt(c*c+h*h),s[1]=Math.sqrt(d*d+y*y),s}function hn(o,l){const s=l??A.create(),c=o[0],h=o[1],d=o[2],y=o[4],n=o[5],r=o[6],t=o[8],e=o[9],u=o[10];return s[0]=Math.sqrt(c*c+h*h+d*d),s[1]=Math.sqrt(y*y+n*n+r*r),s[2]=Math.sqrt(t*t+e*e+u*u),s}function gn(o,l){const s=l??new f(12);return s[0]=1,s[1]=0,s[2]=0,s[4]=0,s[5]=1,s[6]=0,s[8]=o[0],s[9]=o[1],s[10]=1,s}function wn(o,l,s){const c=s??new f(12),h=l[0],d=l[1],y=o[0],n=o[1],r=o[2],t=o[1*4+0],e=o[1*4+1],u=o[1*4+2],p=o[2*4+0],g=o[2*4+1],i=o[2*4+2];return o!==c&&(c[0]=y,c[1]=n,c[2]=r,c[4]=t,c[5]=e,c[6]=u),c[8]=y*h+t*d+p,c[9]=n*h+e*d+g,c[10]=r*h+u*d+i,c}function _n(o,l){const s=l??new f(12),c=Math.cos(o),h=Math.sin(o);return s[0]=c,s[1]=h,s[2]=0,s[4]=-h,s[5]=c,s[6]=0,s[8]=0,s[9]=0,s[10]=1,s}function F(o,l,s){const c=s??new f(12),h=o[0*4+0],d=o[0*4+1],y=o[0*4+2],n=o[1*4+0],r=o[1*4+1],t=o[1*4+2],e=Math.cos(l),u=Math.sin(l);return c[0]=e*h+u*n,c[1]=e*d+u*r,c[2]=e*y+u*t,c[4]=e*n-u*h,c[5]=e*r-u*d,c[6]=e*t-u*y,o!==c&&(c[8]=o[8],c[9]=o[9],c[10]=o[10]),c}function k(o,l){const s=l??new f(12),c=Math.cos(o),h=Math.sin(o);return s[0]=1,s[1]=0,s[2]=0,s[4]=0,s[5]=c,s[6]=h,s[8]=0,s[9]=-h,s[10]=c,s}function E(o,l,s){const c=s??new f(12),h=o[4],d=o[5],y=o[6],n=o[8],r=o[9],t=o[10],e=Math.cos(l),u=Math.sin(l);return c[4]=e*h+u*n,c[5]=e*d+u*r,c[6]=e*y+u*t,c[8]=e*n-u*h,c[9]=e*r-u*d,c[10]=e*t-u*y,o!==c&&(c[0]=o[0],c[1]=o[1],c[2]=o[2]),c}function Fn(o,l){const s=l??new f(12),c=Math.cos(o),h=Math.sin(o);return s[0]=c,s[1]=0,s[2]=-h,s[4]=0,s[5]=1,s[6]=0,s[8]=h,s[9]=0,s[10]=c,s}function zn(o,l,s){const c=s??new f(12),h=o[0*4+0],d=o[0*4+1],y=o[0*4+2],n=o[2*4+0],r=o[2*4+1],t=o[2*4+2],e=Math.cos(l),u=Math.sin(l);return c[0]=e*h-u*n,c[1]=e*d-u*r,c[2]=e*y-u*t,c[8]=e*n+u*h,c[9]=e*r+u*d,c[10]=e*t+u*y,o!==c&&(c[4]=o[4],c[5]=o[5],c[6]=o[6]),c}const Yn=_n,An=F;function Xn(o,l){const s=l??new f(12);return s[0]=o[0],s[1]=0,s[2]=0,s[4]=0,s[5]=o[1],s[6]=0,s[8]=0,s[9]=0,s[10]=1,s}function C(o,l,s){const c=s??new f(12),h=l[0],d=l[1];return c[0]=h*o[0*4+0],c[1]=h*o[0*4+1],c[2]=h*o[0*4+2],c[4]=d*o[1*4+0],c[5]=d*o[1*4+1],c[6]=d*o[1*4+2],o!==c&&(c[8]=o[8],c[9]=o[9],c[10]=o[10]),c}function $n(o,l){const s=l??new f(12);return s[0]=o[0],s[1]=0,s[2]=0,s[4]=0,s[5]=o[1],s[6]=0,s[8]=0,s[9]=0,s[10]=o[2],s}function Sn(o,l,s){const c=s??new f(12),h=l[0],d=l[1],y=l[2];return c[0]=h*o[0*4+0],c[1]=h*o[0*4+1],c[2]=h*o[0*4+2],c[4]=d*o[1*4+0],c[5]=d*o[1*4+1],c[6]=d*o[1*4+2],c[8]=y*o[2*4+0],c[9]=y*o[2*4+1],c[10]=y*o[2*4+2],c}function Wn(o,l){const s=l??new f(12);return s[0]=o,s[1]=0,s[2]=0,s[4]=0,s[5]=o,s[6]=0,s[8]=0,s[9]=0,s[10]=1,s}function Tn(o,l,s){const c=s??new f(12);return c[0]=l*o[0*4+0],c[1]=l*o[0*4+1],c[2]=l*o[0*4+2],c[4]=l*o[1*4+0],c[5]=l*o[1*4+1],c[6]=l*o[1*4+2],o!==c&&(c[8]=o[8],c[9]=o[9],c[10]=o[10]),c}function En(o,l){const s=l??new f(12);return s[0]=o,s[1]=0,s[2]=0,s[4]=0,s[5]=o,s[6]=0,s[8]=0,s[9]=0,s[10]=o,s}function Bn(o,l,s){const c=s??new f(12);return c[0]=l*o[0*4+0],c[1]=l*o[0*4+1],c[2]=l*o[0*4+2],c[4]=l*o[1*4+0],c[5]=l*o[1*4+1],c[6]=l*o[1*4+2],c[8]=l*o[2*4+0],c[9]=l*o[2*4+1],c[10]=l*o[2*4+2],c}return{clone:W,create:P,set:U,fromMat4:B,fromQuat:G,negate:O,copy:L,equalsApproximately:Q,equals:j,identity:tn,transpose:Z,inverse:b,invert:$,determinant:sn,mul:J,multiply:R,setTranslation:m,getTranslation:cn,getAxis:H,setAxis:rn,getScaling:en,get3DScaling:hn,translation:gn,translate:wn,rotation:_n,rotate:F,rotationX:k,rotateX:E,rotationY:Fn,rotateY:zn,rotationZ:Yn,rotateZ:An,scaling:Xn,scale:C,uniformScaling:Wn,uniformScale:Tn,scaling3D:$n,scale3D:Sn,uniformScaling3D:En,uniformScale3D:Bn}}const Pt=new Map;function Xt(f){let w=Pt.get(f);return w||(w=Yt(f),Pt.set(f,w)),w}function $t(f){const w=lt(f);function A(n,r,t,e,u,p,g,i,a,M,x,D,z,q,S,v){const I=new f(16);return n!==void 0&&(I[0]=n,r!==void 0&&(I[1]=r,t!==void 0&&(I[2]=t,e!==void 0&&(I[3]=e,u!==void 0&&(I[4]=u,p!==void 0&&(I[5]=p,g!==void 0&&(I[6]=g,i!==void 0&&(I[7]=i,a!==void 0&&(I[8]=a,M!==void 0&&(I[9]=M,x!==void 0&&(I[10]=x,D!==void 0&&(I[11]=D,z!==void 0&&(I[12]=z,q!==void 0&&(I[13]=q,S!==void 0&&(I[14]=S,v!==void 0&&(I[15]=v)))))))))))))))),I}function P(n,r,t,e,u,p,g,i,a,M,x,D,z,q,S,v,I){const T=I??new f(16);return T[0]=n,T[1]=r,T[2]=t,T[3]=e,T[4]=u,T[5]=p,T[6]=g,T[7]=i,T[8]=a,T[9]=M,T[10]=x,T[11]=D,T[12]=z,T[13]=q,T[14]=S,T[15]=v,T}function U(n,r){const t=r??new f(16);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=0,t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=0,t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function B(n,r){const t=r??new f(16),e=n[0],u=n[1],p=n[2],g=n[3],i=e+e,a=u+u,M=p+p,x=e*i,D=u*i,z=u*a,q=p*i,S=p*a,v=p*M,I=g*i,T=g*a,_=g*M;return t[0]=1-z-v,t[1]=D+_,t[2]=q-T,t[3]=0,t[4]=D-_,t[5]=1-x-v,t[6]=S+I,t[7]=0,t[8]=q+T,t[9]=S-I,t[10]=1-x-z,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function G(n,r){const t=r??new f(16);return t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t[3]=-n[3],t[4]=-n[4],t[5]=-n[5],t[6]=-n[6],t[7]=-n[7],t[8]=-n[8],t[9]=-n[9],t[10]=-n[10],t[11]=-n[11],t[12]=-n[12],t[13]=-n[13],t[14]=-n[14],t[15]=-n[15],t}function O(n,r){const t=r??new f(16);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t}const L=O;function W(n,r){return Math.abs(n[0]-r[0])<V&&Math.abs(n[1]-r[1])<V&&Math.abs(n[2]-r[2])<V&&Math.abs(n[3]-r[3])<V&&Math.abs(n[4]-r[4])<V&&Math.abs(n[5]-r[5])<V&&Math.abs(n[6]-r[6])<V&&Math.abs(n[7]-r[7])<V&&Math.abs(n[8]-r[8])<V&&Math.abs(n[9]-r[9])<V&&Math.abs(n[10]-r[10])<V&&Math.abs(n[11]-r[11])<V&&Math.abs(n[12]-r[12])<V&&Math.abs(n[13]-r[13])<V&&Math.abs(n[14]-r[14])<V&&Math.abs(n[15]-r[15])<V}function Q(n,r){return n[0]===r[0]&&n[1]===r[1]&&n[2]===r[2]&&n[3]===r[3]&&n[4]===r[4]&&n[5]===r[5]&&n[6]===r[6]&&n[7]===r[7]&&n[8]===r[8]&&n[9]===r[9]&&n[10]===r[10]&&n[11]===r[11]&&n[12]===r[12]&&n[13]===r[13]&&n[14]===r[14]&&n[15]===r[15]}function j(n){const r=n??new f(16);return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function tn(n,r){const t=r??new f(16);if(t===n){let Y;return Y=n[1],n[1]=n[4],n[4]=Y,Y=n[2],n[2]=n[8],n[8]=Y,Y=n[3],n[3]=n[12],n[12]=Y,Y=n[6],n[6]=n[9],n[9]=Y,Y=n[7],n[7]=n[13],n[13]=Y,Y=n[11],n[11]=n[14],n[14]=Y,t}const e=n[0*4+0],u=n[0*4+1],p=n[0*4+2],g=n[0*4+3],i=n[1*4+0],a=n[1*4+1],M=n[1*4+2],x=n[1*4+3],D=n[2*4+0],z=n[2*4+1],q=n[2*4+2],S=n[2*4+3],v=n[3*4+0],I=n[3*4+1],T=n[3*4+2],_=n[3*4+3];return t[0]=e,t[1]=i,t[2]=D,t[3]=v,t[4]=u,t[5]=a,t[6]=z,t[7]=I,t[8]=p,t[9]=M,t[10]=q,t[11]=T,t[12]=g,t[13]=x,t[14]=S,t[15]=_,t}function Z(n,r){const t=r??new f(16),e=n[0*4+0],u=n[0*4+1],p=n[0*4+2],g=n[0*4+3],i=n[1*4+0],a=n[1*4+1],M=n[1*4+2],x=n[1*4+3],D=n[2*4+0],z=n[2*4+1],q=n[2*4+2],S=n[2*4+3],v=n[3*4+0],I=n[3*4+1],T=n[3*4+2],_=n[3*4+3],Y=q*_,nn=T*S,un=M*_,an=T*x,ln=M*S,dn=q*x,Mn=p*_,pn=T*g,xn=p*S,Dn=q*g,qn=p*x,Pn=M*g,Un=D*I,In=v*z,vn=i*I,On=v*a,Vn=i*z,rt=D*a,it=e*I,ut=v*u,at=e*z,ft=D*u,ht=e*a,wt=i*u,pt=Y*a+an*z+ln*I-(nn*a+un*z+dn*I),xt=nn*u+Mn*z+Dn*I-(Y*u+pn*z+xn*I),Dt=un*u+pn*a+qn*I-(an*u+Mn*a+Pn*I),yt=dn*u+xn*a+Pn*z-(ln*u+Dn*a+qn*z),yn=1/(e*pt+i*xt+D*Dt+v*yt);return t[0]=yn*pt,t[1]=yn*xt,t[2]=yn*Dt,t[3]=yn*yt,t[4]=yn*(nn*i+un*D+dn*v-(Y*i+an*D+ln*v)),t[5]=yn*(Y*e+pn*D+xn*v-(nn*e+Mn*D+Dn*v)),t[6]=yn*(an*e+Mn*i+Pn*v-(un*e+pn*i+qn*v)),t[7]=yn*(ln*e+Dn*i+qn*D-(dn*e+xn*i+Pn*D)),t[8]=yn*(Un*x+On*S+Vn*_-(In*x+vn*S+rt*_)),t[9]=yn*(In*g+it*S+ft*_-(Un*g+ut*S+at*_)),t[10]=yn*(vn*g+ut*x+ht*_-(On*g+it*x+wt*_)),t[11]=yn*(rt*g+at*x+wt*S-(Vn*g+ft*x+ht*S)),t[12]=yn*(vn*q+rt*T+In*M-(Vn*T+Un*M+On*q)),t[13]=yn*(at*T+Un*p+ut*q-(it*q+ft*T+In*p)),t[14]=yn*(it*M+wt*T+On*p-(ht*T+vn*p+ut*M)),t[15]=yn*(ht*q+Vn*p+ft*M-(at*M+wt*q+rt*p)),t}function b(n){const r=n[0],t=n[0*4+1],e=n[0*4+2],u=n[0*4+3],p=n[1*4+0],g=n[1*4+1],i=n[1*4+2],a=n[1*4+3],M=n[2*4+0],x=n[2*4+1],D=n[2*4+2],z=n[2*4+3],q=n[3*4+0],S=n[3*4+1],v=n[3*4+2],I=n[3*4+3],T=D*I,_=v*z,Y=i*I,nn=v*a,un=i*z,an=D*a,ln=e*I,dn=v*u,Mn=e*z,pn=D*u,xn=e*a,Dn=i*u,qn=T*g+nn*x+un*S-(_*g+Y*x+an*S),Pn=_*t+ln*x+pn*S-(T*t+dn*x+Mn*S),Un=Y*t+dn*g+xn*S-(nn*t+ln*g+Dn*S),In=an*t+Mn*g+Dn*x-(un*t+pn*g+xn*x);return r*qn+p*Pn+M*Un+q*In}const sn=Z;function $(n,r,t){const e=t??new f(16),u=n[0],p=n[1],g=n[2],i=n[3],a=n[4],M=n[5],x=n[6],D=n[7],z=n[8],q=n[9],S=n[10],v=n[11],I=n[12],T=n[13],_=n[14],Y=n[15],nn=r[0],un=r[1],an=r[2],ln=r[3],dn=r[4],Mn=r[5],pn=r[6],xn=r[7],Dn=r[8],qn=r[9],Pn=r[10],Un=r[11],In=r[12],vn=r[13],On=r[14],Vn=r[15];return e[0]=u*nn+a*un+z*an+I*ln,e[1]=p*nn+M*un+q*an+T*ln,e[2]=g*nn+x*un+S*an+_*ln,e[3]=i*nn+D*un+v*an+Y*ln,e[4]=u*dn+a*Mn+z*pn+I*xn,e[5]=p*dn+M*Mn+q*pn+T*xn,e[6]=g*dn+x*Mn+S*pn+_*xn,e[7]=i*dn+D*Mn+v*pn+Y*xn,e[8]=u*Dn+a*qn+z*Pn+I*Un,e[9]=p*Dn+M*qn+q*Pn+T*Un,e[10]=g*Dn+x*qn+S*Pn+_*Un,e[11]=i*Dn+D*qn+v*Pn+Y*Un,e[12]=u*In+a*vn+z*On+I*Vn,e[13]=p*In+M*vn+q*On+T*Vn,e[14]=g*In+x*vn+S*On+_*Vn,e[15]=i*In+D*vn+v*On+Y*Vn,e}const R=$;function J(n,r,t){const e=t??j();return n!==e&&(e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11]),e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function m(n,r){const t=r??w.create();return t[0]=n[12],t[1]=n[13],t[2]=n[14],t}function cn(n,r,t){const e=t??w.create(),u=r*4;return e[0]=n[u+0],e[1]=n[u+1],e[2]=n[u+2],e}function H(n,r,t,e){const u=e===n?e:O(n,e),p=t*4;return u[p+0]=r[0],u[p+1]=r[1],u[p+2]=r[2],u}function rn(n,r){const t=r??w.create(),e=n[0],u=n[1],p=n[2],g=n[4],i=n[5],a=n[6],M=n[8],x=n[9],D=n[10];return t[0]=Math.sqrt(e*e+u*u+p*p),t[1]=Math.sqrt(g*g+i*i+a*a),t[2]=Math.sqrt(M*M+x*x+D*D),t}function en(n,r,t,e,u){const p=u??new f(16),g=Math.tan(Math.PI*.5-.5*n);if(p[0]=g/r,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=g,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[11]=-1,p[12]=0,p[13]=0,p[15]=0,Number.isFinite(e)){const i=1/(t-e);p[10]=e*i,p[14]=e*t*i}else p[10]=-1,p[14]=-t;return p}function hn(n,r,t,e=1/0,u){const p=u??new f(16),g=1/Math.tan(n*.5);if(p[0]=g/r,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=g,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[11]=-1,p[12]=0,p[13]=0,p[15]=0,e===1/0)p[10]=0,p[14]=t;else{const i=1/(e-t);p[10]=t*i,p[14]=e*t*i}return p}function gn(n,r,t,e,u,p,g){const i=g??new f(16);return i[0]=2/(r-n),i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=2/(e-t),i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1/(u-p),i[11]=0,i[12]=(r+n)/(n-r),i[13]=(e+t)/(t-e),i[14]=u/(u-p),i[15]=1,i}function wn(n,r,t,e,u,p,g){const i=g??new f(16),a=r-n,M=e-t,x=u-p;return i[0]=2*u/a,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=2*u/M,i[6]=0,i[7]=0,i[8]=(n+r)/a,i[9]=(e+t)/M,i[10]=p/x,i[11]=-1,i[12]=0,i[13]=0,i[14]=u*p/x,i[15]=0,i}function _n(n,r,t,e,u,p=1/0,g){const i=g??new f(16),a=r-n,M=e-t;if(i[0]=2*u/a,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=2*u/M,i[6]=0,i[7]=0,i[8]=(n+r)/a,i[9]=(e+t)/M,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,p===1/0)i[10]=0,i[14]=u;else{const x=1/(p-u);i[10]=u*x,i[14]=p*u*x}return i}const F=w.create(),k=w.create(),E=w.create();function Fn(n,r,t,e){const u=e??new f(16);return w.normalize(w.subtract(r,n,E),E),w.normalize(w.cross(t,E,F),F),w.normalize(w.cross(E,F,k),k),u[0]=F[0],u[1]=F[1],u[2]=F[2],u[3]=0,u[4]=k[0],u[5]=k[1],u[6]=k[2],u[7]=0,u[8]=E[0],u[9]=E[1],u[10]=E[2],u[11]=0,u[12]=n[0],u[13]=n[1],u[14]=n[2],u[15]=1,u}function zn(n,r,t,e){const u=e??new f(16);return w.normalize(w.subtract(n,r,E),E),w.normalize(w.cross(t,E,F),F),w.normalize(w.cross(E,F,k),k),u[0]=F[0],u[1]=F[1],u[2]=F[2],u[3]=0,u[4]=k[0],u[5]=k[1],u[6]=k[2],u[7]=0,u[8]=E[0],u[9]=E[1],u[10]=E[2],u[11]=0,u[12]=n[0],u[13]=n[1],u[14]=n[2],u[15]=1,u}function Yn(n,r,t,e){const u=e??new f(16);return w.normalize(w.subtract(n,r,E),E),w.normalize(w.cross(t,E,F),F),w.normalize(w.cross(E,F,k),k),u[0]=F[0],u[1]=k[0],u[2]=E[0],u[3]=0,u[4]=F[1],u[5]=k[1],u[6]=E[1],u[7]=0,u[8]=F[2],u[9]=k[2],u[10]=E[2],u[11]=0,u[12]=-(F[0]*n[0]+F[1]*n[1]+F[2]*n[2]),u[13]=-(k[0]*n[0]+k[1]*n[1]+k[2]*n[2]),u[14]=-(E[0]*n[0]+E[1]*n[1]+E[2]*n[2]),u[15]=1,u}function An(n,r){const t=r??new f(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function Xn(n,r,t){const e=t??new f(16),u=r[0],p=r[1],g=r[2],i=n[0],a=n[1],M=n[2],x=n[3],D=n[1*4+0],z=n[1*4+1],q=n[1*4+2],S=n[1*4+3],v=n[2*4+0],I=n[2*4+1],T=n[2*4+2],_=n[2*4+3],Y=n[3*4+0],nn=n[3*4+1],un=n[3*4+2],an=n[3*4+3];return n!==e&&(e[0]=i,e[1]=a,e[2]=M,e[3]=x,e[4]=D,e[5]=z,e[6]=q,e[7]=S,e[8]=v,e[9]=I,e[10]=T,e[11]=_),e[12]=i*u+D*p+v*g+Y,e[13]=a*u+z*p+I*g+nn,e[14]=M*u+q*p+T*g+un,e[15]=x*u+S*p+_*g+an,e}function C(n,r){const t=r??new f(16),e=Math.cos(n),u=Math.sin(n);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e,t[6]=u,t[7]=0,t[8]=0,t[9]=-u,t[10]=e,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function $n(n,r,t){const e=t??new f(16),u=n[4],p=n[5],g=n[6],i=n[7],a=n[8],M=n[9],x=n[10],D=n[11],z=Math.cos(r),q=Math.sin(r);return e[4]=z*u+q*a,e[5]=z*p+q*M,e[6]=z*g+q*x,e[7]=z*i+q*D,e[8]=z*a-q*u,e[9]=z*M-q*p,e[10]=z*x-q*g,e[11]=z*D-q*i,n!==e&&(e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e}function Sn(n,r){const t=r??new f(16),e=Math.cos(n),u=Math.sin(n);return t[0]=e,t[1]=0,t[2]=-u,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=u,t[9]=0,t[10]=e,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Wn(n,r,t){const e=t??new f(16),u=n[0*4+0],p=n[0*4+1],g=n[0*4+2],i=n[0*4+3],a=n[2*4+0],M=n[2*4+1],x=n[2*4+2],D=n[2*4+3],z=Math.cos(r),q=Math.sin(r);return e[0]=z*u-q*a,e[1]=z*p-q*M,e[2]=z*g-q*x,e[3]=z*i-q*D,e[8]=z*a+q*u,e[9]=z*M+q*p,e[10]=z*x+q*g,e[11]=z*D+q*i,n!==e&&(e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e}function Tn(n,r){const t=r??new f(16),e=Math.cos(n),u=Math.sin(n);return t[0]=e,t[1]=u,t[2]=0,t[3]=0,t[4]=-u,t[5]=e,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function En(n,r,t){const e=t??new f(16),u=n[0*4+0],p=n[0*4+1],g=n[0*4+2],i=n[0*4+3],a=n[1*4+0],M=n[1*4+1],x=n[1*4+2],D=n[1*4+3],z=Math.cos(r),q=Math.sin(r);return e[0]=z*u+q*a,e[1]=z*p+q*M,e[2]=z*g+q*x,e[3]=z*i+q*D,e[4]=z*a-q*u,e[5]=z*M-q*p,e[6]=z*x-q*g,e[7]=z*D-q*i,n!==e&&(e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e}function Bn(n,r,t){const e=t??new f(16);let u=n[0],p=n[1],g=n[2];const i=Math.sqrt(u*u+p*p+g*g);u/=i,p/=i,g/=i;const a=u*u,M=p*p,x=g*g,D=Math.cos(r),z=Math.sin(r),q=1-D;return e[0]=a+(1-a)*D,e[1]=u*p*q+g*z,e[2]=u*g*q-p*z,e[3]=0,e[4]=u*p*q-g*z,e[5]=M+(1-M)*D,e[6]=p*g*q+u*z,e[7]=0,e[8]=u*g*q+p*z,e[9]=p*g*q-u*z,e[10]=x+(1-x)*D,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}const o=Bn;function l(n,r,t,e){const u=e??new f(16);let p=r[0],g=r[1],i=r[2];const a=Math.sqrt(p*p+g*g+i*i);p/=a,g/=a,i/=a;const M=p*p,x=g*g,D=i*i,z=Math.cos(t),q=Math.sin(t),S=1-z,v=M+(1-M)*z,I=p*g*S+i*q,T=p*i*S-g*q,_=p*g*S-i*q,Y=x+(1-x)*z,nn=g*i*S+p*q,un=p*i*S+g*q,an=g*i*S-p*q,ln=D+(1-D)*z,dn=n[0],Mn=n[1],pn=n[2],xn=n[3],Dn=n[4],qn=n[5],Pn=n[6],Un=n[7],In=n[8],vn=n[9],On=n[10],Vn=n[11];return u[0]=v*dn+I*Dn+T*In,u[1]=v*Mn+I*qn+T*vn,u[2]=v*pn+I*Pn+T*On,u[3]=v*xn+I*Un+T*Vn,u[4]=_*dn+Y*Dn+nn*In,u[5]=_*Mn+Y*qn+nn*vn,u[6]=_*pn+Y*Pn+nn*On,u[7]=_*xn+Y*Un+nn*Vn,u[8]=un*dn+an*Dn+ln*In,u[9]=un*Mn+an*qn+ln*vn,u[10]=un*pn+an*Pn+ln*On,u[11]=un*xn+an*Un+ln*Vn,n!==u&&(u[12]=n[12],u[13]=n[13],u[14]=n[14],u[15]=n[15]),u}const s=l;function c(n,r){const t=r??new f(16);return t[0]=n[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=n[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function h(n,r,t){const e=t??new f(16),u=r[0],p=r[1],g=r[2];return e[0]=u*n[0*4+0],e[1]=u*n[0*4+1],e[2]=u*n[0*4+2],e[3]=u*n[0*4+3],e[4]=p*n[1*4+0],e[5]=p*n[1*4+1],e[6]=p*n[1*4+2],e[7]=p*n[1*4+3],e[8]=g*n[2*4+0],e[9]=g*n[2*4+1],e[10]=g*n[2*4+2],e[11]=g*n[2*4+3],n!==e&&(e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e}function d(n,r){const t=r??new f(16);return t[0]=n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function y(n,r,t){const e=t??new f(16);return e[0]=r*n[0*4+0],e[1]=r*n[0*4+1],e[2]=r*n[0*4+2],e[3]=r*n[0*4+3],e[4]=r*n[1*4+0],e[5]=r*n[1*4+1],e[6]=r*n[1*4+2],e[7]=r*n[1*4+3],e[8]=r*n[2*4+0],e[9]=r*n[2*4+1],e[10]=r*n[2*4+2],e[11]=r*n[2*4+3],n!==e&&(e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e}return{create:A,set:P,fromMat3:U,fromQuat:B,negate:G,copy:O,clone:L,equalsApproximately:W,equals:Q,identity:j,transpose:tn,inverse:Z,determinant:b,invert:sn,multiply:$,mul:R,setTranslation:J,getTranslation:m,getAxis:cn,setAxis:H,getScaling:rn,perspective:en,perspectiveReverseZ:hn,ortho:gn,frustum:wn,frustumReverseZ:_n,aim:Fn,cameraAim:zn,lookAt:Yn,translation:An,translate:Xn,rotationX:C,rotateX:$n,rotationY:Sn,rotateY:Wn,rotationZ:Tn,rotateZ:En,axisRotation:Bn,rotation:o,axisRotate:l,rotate:s,scaling:c,scale:h,uniformScaling:d,uniformScale:y}}const Ut=new Map;function Wt(f){let w=Ut.get(f);return w||(w=$t(f),Ut.set(f,w)),w}function Zt(f){const w=lt(f);function A(o,l,s,c){const h=new f(4);return o!==void 0&&(h[0]=o,l!==void 0&&(h[1]=l,s!==void 0&&(h[2]=s,c!==void 0&&(h[3]=c)))),h}const P=A;function U(o,l,s,c,h){const d=h??new f(4);return d[0]=o,d[1]=l,d[2]=s,d[3]=c,d}function B(o,l,s){const c=s??new f(4),h=l*.5,d=Math.sin(h);return c[0]=d*o[0],c[1]=d*o[1],c[2]=d*o[2],c[3]=Math.cos(h),c}function G(o,l){const s=l??w.create(3),c=Math.acos(o[3])*2,h=Math.sin(c*.5);return h>V?(s[0]=o[0]/h,s[1]=o[1]/h,s[2]=o[2]/h):(s[0]=1,s[1]=0,s[2]=0),{angle:c,axis:s}}function O(o,l){const s=wn(o,l);return Math.acos(2*s*s-1)}function L(o,l,s){const c=s??new f(4),h=o[0],d=o[1],y=o[2],n=o[3],r=l[0],t=l[1],e=l[2],u=l[3];return c[0]=h*u+n*r+d*e-y*t,c[1]=d*u+n*t+y*r-h*e,c[2]=y*u+n*e+h*t-d*r,c[3]=n*u-h*r-d*t-y*e,c}const W=L;function Q(o,l,s){const c=s??new f(4),h=l*.5,d=o[0],y=o[1],n=o[2],r=o[3],t=Math.sin(h),e=Math.cos(h);return c[0]=d*e+r*t,c[1]=y*e+n*t,c[2]=n*e-y*t,c[3]=r*e-d*t,c}function j(o,l,s){const c=s??new f(4),h=l*.5,d=o[0],y=o[1],n=o[2],r=o[3],t=Math.sin(h),e=Math.cos(h);return c[0]=d*e-n*t,c[1]=y*e+r*t,c[2]=n*e+d*t,c[3]=r*e-y*t,c}function tn(o,l,s){const c=s??new f(4),h=l*.5,d=o[0],y=o[1],n=o[2],r=o[3],t=Math.sin(h),e=Math.cos(h);return c[0]=d*e+y*t,c[1]=y*e-d*t,c[2]=n*e+r*t,c[3]=r*e-n*t,c}function Z(o,l,s,c){const h=c??new f(4),d=o[0],y=o[1],n=o[2],r=o[3];let t=l[0],e=l[1],u=l[2],p=l[3],g=d*t+y*e+n*u+r*p;g<0&&(g=-g,t=-t,e=-e,u=-u,p=-p);let i,a;if(1-g>V){const M=Math.acos(g),x=Math.sin(M);i=Math.sin((1-s)*M)/x,a=Math.sin(s*M)/x}else i=1-s,a=s;return h[0]=i*d+a*t,h[1]=i*y+a*e,h[2]=i*n+a*u,h[3]=i*r+a*p,h}function b(o,l){const s=l??new f(4),c=o[0],h=o[1],d=o[2],y=o[3],n=c*c+h*h+d*d+y*y,r=n?1/n:0;return s[0]=-c*r,s[1]=-h*r,s[2]=-d*r,s[3]=y*r,s}function sn(o,l){const s=l??new f(4);return s[0]=-o[0],s[1]=-o[1],s[2]=-o[2],s[3]=o[3],s}function $(o,l){const s=l??new f(4),c=o[0]+o[5]+o[10];if(c>0){const h=Math.sqrt(c+1);s[3]=.5*h;const d=.5/h;s[0]=(o[6]-o[9])*d,s[1]=(o[8]-o[2])*d,s[2]=(o[1]-o[4])*d}else{let h=0;o[5]>o[0]&&(h=1),o[10]>o[h*4+h]&&(h=2);const d=(h+1)%3,y=(h+2)%3,n=Math.sqrt(o[h*4+h]-o[d*4+d]-o[y*4+y]+1);s[h]=.5*n;const r=.5/n;s[3]=(o[d*4+y]-o[y*4+d])*r,s[d]=(o[d*4+h]+o[h*4+d])*r,s[y]=(o[y*4+h]+o[h*4+y])*r}return s}function R(o,l,s,c,h){const d=h??new f(4),y=o*.5,n=l*.5,r=s*.5,t=Math.sin(y),e=Math.cos(y),u=Math.sin(n),p=Math.cos(n),g=Math.sin(r),i=Math.cos(r);switch(c){case"xyz":d[0]=t*p*i+e*u*g,d[1]=e*u*i-t*p*g,d[2]=e*p*g+t*u*i,d[3]=e*p*i-t*u*g;break;case"xzy":d[0]=t*p*i-e*u*g,d[1]=e*u*i-t*p*g,d[2]=e*p*g+t*u*i,d[3]=e*p*i+t*u*g;break;case"yxz":d[0]=t*p*i+e*u*g,d[1]=e*u*i-t*p*g,d[2]=e*p*g-t*u*i,d[3]=e*p*i+t*u*g;break;case"yzx":d[0]=t*p*i+e*u*g,d[1]=e*u*i+t*p*g,d[2]=e*p*g-t*u*i,d[3]=e*p*i-t*u*g;break;case"zxy":d[0]=t*p*i-e*u*g,d[1]=e*u*i+t*p*g,d[2]=e*p*g+t*u*i,d[3]=e*p*i-t*u*g;break;case"zyx":d[0]=t*p*i-e*u*g,d[1]=e*u*i+t*p*g,d[2]=e*p*g-t*u*i,d[3]=e*p*i+t*u*g;break;default:throw new Error(`Unknown rotation order: ${c}`)}return d}function J(o,l){const s=l??new f(4);return s[0]=o[0],s[1]=o[1],s[2]=o[2],s[3]=o[3],s}const m=J;function cn(o,l,s){const c=s??new f(4);return c[0]=o[0]+l[0],c[1]=o[1]+l[1],c[2]=o[2]+l[2],c[3]=o[3]+l[3],c}function H(o,l,s){const c=s??new f(4);return c[0]=o[0]-l[0],c[1]=o[1]-l[1],c[2]=o[2]-l[2],c[3]=o[3]-l[3],c}const rn=H;function en(o,l,s){const c=s??new f(4);return c[0]=o[0]*l,c[1]=o[1]*l,c[2]=o[2]*l,c[3]=o[3]*l,c}const hn=en;function gn(o,l,s){const c=s??new f(4);return c[0]=o[0]/l,c[1]=o[1]/l,c[2]=o[2]/l,c[3]=o[3]/l,c}function wn(o,l){return o[0]*l[0]+o[1]*l[1]+o[2]*l[2]+o[3]*l[3]}function _n(o,l,s,c){const h=c??new f(4);return h[0]=o[0]+s*(l[0]-o[0]),h[1]=o[1]+s*(l[1]-o[1]),h[2]=o[2]+s*(l[2]-o[2]),h[3]=o[3]+s*(l[3]-o[3]),h}function F(o){const l=o[0],s=o[1],c=o[2],h=o[3];return Math.sqrt(l*l+s*s+c*c+h*h)}const k=F;function E(o){const l=o[0],s=o[1],c=o[2],h=o[3];return l*l+s*s+c*c+h*h}const Fn=E;function zn(o,l){const s=l??new f(4),c=o[0],h=o[1],d=o[2],y=o[3],n=Math.sqrt(c*c+h*h+d*d+y*y);return n>1e-5?(s[0]=c/n,s[1]=h/n,s[2]=d/n,s[3]=y/n):(s[0]=0,s[1]=0,s[2]=0,s[3]=1),s}function Yn(o,l){return Math.abs(o[0]-l[0])<V&&Math.abs(o[1]-l[1])<V&&Math.abs(o[2]-l[2])<V&&Math.abs(o[3]-l[3])<V}function An(o,l){return o[0]===l[0]&&o[1]===l[1]&&o[2]===l[2]&&o[3]===l[3]}function Xn(o){const l=o??new f(4);return l[0]=0,l[1]=0,l[2]=0,l[3]=1,l}const C=w.create(),$n=w.create(),Sn=w.create();function Wn(o,l,s){const c=s??new f(4),h=w.dot(o,l);return h<-.999999?(w.cross($n,o,C),w.len(C)<1e-6&&w.cross(Sn,o,C),w.normalize(C,C),B(C,Math.PI,c),c):h>.999999?(c[0]=0,c[1]=0,c[2]=0,c[3]=1,c):(w.cross(o,l,C),c[0]=C[0],c[1]=C[1],c[2]=C[2],c[3]=1+h,zn(c,c))}const Tn=new f(4),En=new f(4);function Bn(o,l,s,c,h,d){const y=d??new f(4);return Z(o,c,h,Tn),Z(l,s,h,En),Z(Tn,En,2*h*(1-h),y),y}return{create:A,fromValues:P,set:U,fromAxisAngle:B,toAxisAngle:G,angle:O,multiply:L,mul:W,rotateX:Q,rotateY:j,rotateZ:tn,slerp:Z,inverse:b,conjugate:sn,fromMat:$,fromEuler:R,copy:J,clone:m,add:cn,subtract:H,sub:rn,mulScalar:en,scale:hn,divScalar:gn,dot:wn,lerp:_n,length:F,len:k,lengthSq:E,lenSq:Fn,normalize:zn,equalsApproximately:Yn,equals:An,identity:Xn,rotationTo:Wn,sqlerp:Bn}}const It=new Map;function jt(f){let w=It.get(f);return w||(w=Zt(f),It.set(f,w)),w}function Rt(f){function w(s,c,h,d){const y=new f(4);return s!==void 0&&(y[0]=s,c!==void 0&&(y[1]=c,h!==void 0&&(y[2]=h,d!==void 0&&(y[3]=d)))),y}const A=w;function P(s,c,h,d,y){const n=y??new f(4);return n[0]=s,n[1]=c,n[2]=h,n[3]=d,n}function U(s,c){const h=c??new f(4);return h[0]=Math.ceil(s[0]),h[1]=Math.ceil(s[1]),h[2]=Math.ceil(s[2]),h[3]=Math.ceil(s[3]),h}function B(s,c){const h=c??new f(4);return h[0]=Math.floor(s[0]),h[1]=Math.floor(s[1]),h[2]=Math.floor(s[2]),h[3]=Math.floor(s[3]),h}function G(s,c){const h=c??new f(4);return h[0]=Math.round(s[0]),h[1]=Math.round(s[1]),h[2]=Math.round(s[2]),h[3]=Math.round(s[3]),h}function O(s,c=0,h=1,d){const y=d??new f(4);return y[0]=Math.min(h,Math.max(c,s[0])),y[1]=Math.min(h,Math.max(c,s[1])),y[2]=Math.min(h,Math.max(c,s[2])),y[3]=Math.min(h,Math.max(c,s[3])),y}function L(s,c,h){const d=h??new f(4);return d[0]=s[0]+c[0],d[1]=s[1]+c[1],d[2]=s[2]+c[2],d[3]=s[3]+c[3],d}function W(s,c,h,d){const y=d??new f(4);return y[0]=s[0]+c[0]*h,y[1]=s[1]+c[1]*h,y[2]=s[2]+c[2]*h,y[3]=s[3]+c[3]*h,y}function Q(s,c,h){const d=h??new f(4);return d[0]=s[0]-c[0],d[1]=s[1]-c[1],d[2]=s[2]-c[2],d[3]=s[3]-c[3],d}const j=Q;function tn(s,c){return Math.abs(s[0]-c[0])<V&&Math.abs(s[1]-c[1])<V&&Math.abs(s[2]-c[2])<V&&Math.abs(s[3]-c[3])<V}function Z(s,c){return s[0]===c[0]&&s[1]===c[1]&&s[2]===c[2]&&s[3]===c[3]}function b(s,c,h,d){const y=d??new f(4);return y[0]=s[0]+h*(c[0]-s[0]),y[1]=s[1]+h*(c[1]-s[1]),y[2]=s[2]+h*(c[2]-s[2]),y[3]=s[3]+h*(c[3]-s[3]),y}function sn(s,c,h,d){const y=d??new f(4);return y[0]=s[0]+h[0]*(c[0]-s[0]),y[1]=s[1]+h[1]*(c[1]-s[1]),y[2]=s[2]+h[2]*(c[2]-s[2]),y[3]=s[3]+h[3]*(c[3]-s[3]),y}function $(s,c,h){const d=h??new f(4);return d[0]=Math.max(s[0],c[0]),d[1]=Math.max(s[1],c[1]),d[2]=Math.max(s[2],c[2]),d[3]=Math.max(s[3],c[3]),d}function R(s,c,h){const d=h??new f(4);return d[0]=Math.min(s[0],c[0]),d[1]=Math.min(s[1],c[1]),d[2]=Math.min(s[2],c[2]),d[3]=Math.min(s[3],c[3]),d}function J(s,c,h){const d=h??new f(4);return d[0]=s[0]*c,d[1]=s[1]*c,d[2]=s[2]*c,d[3]=s[3]*c,d}const m=J;function cn(s,c,h){const d=h??new f(4);return d[0]=s[0]/c,d[1]=s[1]/c,d[2]=s[2]/c,d[3]=s[3]/c,d}function H(s,c){const h=c??new f(4);return h[0]=1/s[0],h[1]=1/s[1],h[2]=1/s[2],h[3]=1/s[3],h}const rn=H;function en(s,c){return s[0]*c[0]+s[1]*c[1]+s[2]*c[2]+s[3]*c[3]}function hn(s){const c=s[0],h=s[1],d=s[2],y=s[3];return Math.sqrt(c*c+h*h+d*d+y*y)}const gn=hn;function wn(s){const c=s[0],h=s[1],d=s[2],y=s[3];return c*c+h*h+d*d+y*y}const _n=wn;function F(s,c){const h=s[0]-c[0],d=s[1]-c[1],y=s[2]-c[2],n=s[3]-c[3];return Math.sqrt(h*h+d*d+y*y+n*n)}const k=F;function E(s,c){const h=s[0]-c[0],d=s[1]-c[1],y=s[2]-c[2],n=s[3]-c[3];return h*h+d*d+y*y+n*n}const Fn=E;function zn(s,c){const h=c??new f(4),d=s[0],y=s[1],n=s[2],r=s[3],t=Math.sqrt(d*d+y*y+n*n+r*r);return t>1e-5?(h[0]=d/t,h[1]=y/t,h[2]=n/t,h[3]=r/t):(h[0]=0,h[1]=0,h[2]=0,h[3]=0),h}function Yn(s,c){const h=c??new f(4);return h[0]=-s[0],h[1]=-s[1],h[2]=-s[2],h[3]=-s[3],h}function An(s,c){const h=c??new f(4);return h[0]=s[0],h[1]=s[1],h[2]=s[2],h[3]=s[3],h}const Xn=An;function C(s,c,h){const d=h??new f(4);return d[0]=s[0]*c[0],d[1]=s[1]*c[1],d[2]=s[2]*c[2],d[3]=s[3]*c[3],d}const $n=C;function Sn(s,c,h){const d=h??new f(4);return d[0]=s[0]/c[0],d[1]=s[1]/c[1],d[2]=s[2]/c[2],d[3]=s[3]/c[3],d}const Wn=Sn;function Tn(s){const c=s??new f(4);return c[0]=0,c[1]=0,c[2]=0,c[3]=0,c}function En(s,c,h){const d=h??new f(4),y=s[0],n=s[1],r=s[2],t=s[3];return d[0]=c[0]*y+c[4]*n+c[8]*r+c[12]*t,d[1]=c[1]*y+c[5]*n+c[9]*r+c[13]*t,d[2]=c[2]*y+c[6]*n+c[10]*r+c[14]*t,d[3]=c[3]*y+c[7]*n+c[11]*r+c[15]*t,d}function Bn(s,c,h){const d=h??new f(4);return zn(s,d),J(d,c,d)}function o(s,c,h){const d=h??new f(4);return hn(s)>c?Bn(s,c,d):An(s,d)}function l(s,c,h){const d=h??new f(4);return b(s,c,.5,d)}return{create:w,fromValues:A,set:P,ceil:U,floor:B,round:G,clamp:O,add:L,addScaled:W,subtract:Q,sub:j,equalsApproximately:tn,equals:Z,lerp:b,lerpV:sn,max:$,min:R,mulScalar:J,scale:m,divScalar:cn,inverse:H,invert:rn,dot:en,length:hn,len:gn,lengthSq:wn,lenSq:_n,distance:F,dist:k,distanceSq:E,distSq:Fn,normalize:zn,negate:Yn,copy:An,clone:Xn,multiply:C,mul:$n,divide:Sn,div:Wn,zero:Tn,transformMat4:En,setLength:Bn,truncate:o,midpoint:l}}const St=new Map;function Lt(f){let w=St.get(f);return w||(w=Rt(f),St.set(f,w)),w}function Mt(f,w,A,P,U,B){return{mat3:Xt(f),mat4:Wt(w),quat:jt(A),vec2:Bt(P),vec3:lt(U),vec4:Lt(B)}}const{mat3:ss,mat4:Zn,quat:Rn,vec2:es,vec3:K,vec4:Tt}=Mt(Float32Array,Float32Array,Float32Array,Float32Array,Float32Array,Float32Array);Mt(Float64Array,Float64Array,Float64Array,Float64Array,Float64Array,Float64Array);Mt(Et,Array,Array,Array,Array,Array);const mn=f=>f*(Math.PI/180);class Ht{constructor(){N(this,"position");N(this,"scale");N(this,"quaternion");this.position=K.create(),this.scale=K.create(1,1,1),this.quaternion=Rn.identity()}get modelMatrix(){let w=Zn.identity();const{axis:A,angle:P}=Rn.toAxisAngle(this.quaternion);return w=Zn.translate(w,this.position),w=Zn.rotate(w,A,P),w=Zn.scale(w,this.scale),w}reset(){this.position=K.create(),this.scale=K.create(1,1,1),this.quaternion=Rn.identity()}rotateX(w){this.quaternion=Rn.rotateX(this.quaternion,mn(w))}rotateY(w){this.quaternion=Rn.rotateY(this.quaternion,mn(w))}rotateZ(w){this.quaternion=Rn.rotateZ(this.quaternion,mn(w))}translate(w){this.position=K.add(this.position,w)}setPosition(w){this.position=w}setRotation(w,A){this.quaternion=Rn.fromAxisAngle(A,mn(w))}scaleX(w){this.scale[0]=w}scaleY(w){this.scale[1]=w}scaleZ(w){this.scale[2]=w}scaleAll(w){const[A,P,U]=w;this.scaleX(A),this.scaleY(P),this.scaleZ(U)}}class os extends Ht{constructor({fov:A=60,aspect:P=1,near:U=.1,far:B=1e3}={}){super();N(this,"fov");N(this,"aspect");N(this,"near");N(this,"far");N(this,"front",K.create(0,0,-1));N(this,"up",K.create(0,1,0));N(this,"right",K.create());this.fov=A,this.aspect=P,this.near=U,this.far=B,this.position=K.create(0,0,3)}get viewMatrix(){return this.right=K.normalize(K.cross(this.front,this.up)),this.up=K.normalize(K.cross(this.right,this.front)),Zn.lookAt(this.position,K.add(this.position,this.front),this.up)}get viewMatrixInverse(){return Zn.inverse(this.viewMatrix)}get projectionMatrix(){return Zn.perspective(mn(this.fov),this.aspect,this.near,this.far)}get projectionMatrixInverse(){return Zn.inverse(this.projectionMatrix)}get viewProjectionMatrix(){return Zn.multiply(this.projectionMatrix,this.viewMatrix)}}async function cs({adapterOptions:f,deviceOptions:w}={}){if(!navigator.gpu)throw new Error("WebGPU not supported");const A=await Nt(f),P=await Qt(A,typeof w=="function"?w(A):w);return{adapter:A,device:P}}async function Nt(f){if(!navigator.gpu)throw new Error("WebGPU not supported");const w=await navigator.gpu.requestAdapter(f);if(!w)throw new Error("Error requesting WebGPU adapter");return w}async function Qt(f,w){const A=await f.requestDevice(w);return A.lost.then(P=>{console.error(`WebGPU device was lost: ${P.message}`),alert("A WebGPU error has been encountered. Reloading the page might fix the error."),window.location.reload()}),A}function rs(f){let w=0;const A=(P,U)=>{w=U-P,f(w),window.requestAnimationFrame(B=>A(U,B))};window.requestAnimationFrame(P=>A(0,P))}const kt=(f,w,A)=>{f.queue.writeBuffer(w,0,A)};class vt{constructor({vertices:w,indices:A}){N(this,"vertices");N(this,"vertexBuffer");N(this,"indices");N(this,"indexBuffer");this.vertices=new Float32Array(w),this.indices=new Uint32Array(A)}load(w){this.vertexBuffer=w.createBuffer({label:"Vertex Buffer",size:this.vertices.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST}),w.queue.writeBuffer(this.vertexBuffer,0,this.vertices),this.indexBuffer=w.createBuffer({label:"Index Buffer",size:this.indices.byteLength,usage:GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST}),w.queue.writeBuffer(this.indexBuffer,0,this.indices)}}var Ln,Hn,Qn,kn,Jn;class Jt{constructor(w){fn(this,Ln);fn(this,Hn);fn(this,Qn);N(this,"descriptor");fn(this,kn,new WeakMap);fn(this,Jn,new WeakMap);this.descriptor={usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST,...w};const{width:A,height:P,depthOrArrayLayers:U}=this.getDimension(this.descriptor.size);on(this,Ln,A),on(this,Hn,P),on(this,Qn,U)}load(w){let A=X(this,kn).get(w);return A||(A=w.createTexture(this.descriptor),X(this,kn).set(w,A)),A}write(w,A){const P=this.load(w);w.queue.writeTexture({texture:P},A,{bytesPerRow:X(this,Ln),rowsPerImage:X(this,Hn)},{width:X(this,Ln),height:X(this,Hn),depthOrArrayLayers:X(this,Qn)})}createView(w){const A=this.load(w);let P=X(this,Jn).get(w);return P||(P=A.createView(),X(this,Jn).set(w,P)),P}updateSize(w){this.descriptor.size=w;const{width:A,height:P,depthOrArrayLayers:U}=this.getDimension(this.descriptor.size);on(this,Ln,A),on(this,Hn,P),on(this,Qn,U),on(this,kn,new WeakMap),on(this,Jn,new WeakMap)}getDimension(w){if("width"in w){const{width:A,height:P,depthOrArrayLayers:U}=w;return{width:A,height:P,depthOrArrayLayers:U}}else{const[A,P,U]=[...w];return{width:A,height:P,depthOrArrayLayers:U}}}}Ln=new WeakMap,Hn=new WeakMap,Qn=new WeakMap,kn=new WeakMap,Jn=new WeakMap;class dt{constructor(w){N(this,"value");if(Array.isArray(w))this.value=Tt.fromValues(...w);else{const{red:A,green:P,blue:U,alpha:B}=w;this.value=Tt.fromValues(A,P,U,B)}}static fromCssString(w){const P=new OffscreenCanvas(1,1).getContext("2d",{willReadFrequently:!0});if(!P)throw new Error("Could not get 2d context");P.clearRect(0,0,1,1),P.fillStyle=w,P.fillRect(0,0,1,1);const[U,B,G,O]=P.getImageData(0,0,1,1).data;return new dt([U/255,B/255,G/255,O/255])}}var bn,jn,Kn,Cn;class is{constructor({context:w,device:A,clearColor:P="white"}){fn(this,bn);fn(this,jn);fn(this,Kn);N(this,"depthTexture");fn(this,Cn,new WeakMap);on(this,jn,A),on(this,bn,w),this.depthTexture=new Jt({label:"Depth Texture",size:[w.canvas.width,w.canvas.height],format:"depth24plus",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING});const U=navigator.gpu.getPreferredCanvasFormat();w.configure({device:A,format:U,alphaMode:"premultiplied"}),typeof P=="string"?on(this,Kn,dt.fromCssString(P)):on(this,Kn,P)}onCanvasResized(w,A){this.depthTexture.updateSize({width:w,height:A})}load(w){const A=X(this,jn).createRenderBundleEncoder({colorFormats:[navigator.gpu.getPreferredCanvasFormat()],depthStencilFormat:"depth24plus"});w.render(A),X(this,Cn).set(w,A.finish())}render(w,{camera:A,view:P,depth:U=!0}={}){w.update(X(this,jn),A);const B=X(this,jn).createCommandEncoder(),G={colorAttachments:[{view:P||X(this,bn).getCurrentTexture().createView(),clearValue:X(this,Kn).value,loadOp:"clear",storeOp:"store"}]};U&&(G.depthStencilAttachment={view:this.depthTexture.createView(X(this,jn)),depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"});const O=B.beginRenderPass(G),L=X(this,Cn).get(w);L?O.executeBundles([L]):w.render(O),O.end();const W=B.finish();X(this,jn).queue.submit([W])}}bn=new WeakMap,jn=new WeakMap,Kn=new WeakMap,Cn=new WeakMap;class us extends vt{constructor({radiusTop:w=1,radiusBottom:A=1,height:P=1,radialSegments:U=32,heightSegments:B=1,openEnded:G=!1,thetaStart:O=0,thetaLength:L=Math.PI*2}={}){U=Math.floor(U),B=Math.floor(B);const W=[],Q=[];let j=0;const tn=[],Z=P/2;b(),G===!1&&(w>0&&sn(!0),A>0&&sn(!1)),super({vertices:W,indices:Q});function b(){for(let $=0;$<=B;$++){const R=[],J=$/B,m=J*(A-w)+w;for(let cn=0;cn<=U;cn++){const rn=cn/U*L+O,en=Math.sin(rn),hn=Math.cos(rn);W[j*3]=m*en,W[j*3+1]=-J*P+Z,W[j*3+2]=m*hn,R.push(j++)}tn.push(R)}for(let $=0;$<U;$++)for(let R=0;R<B;R++){const J=tn[R][$],m=tn[R+1][$],cn=tn[R+1][$+1],H=tn[R][$+1];(w>0||R!==0)&&Q.push(J,m,H),(A>0||R!==B-1)&&Q.push(m,cn,H)}}function sn($){const R=j,J=$===!0?w:A,m=$===!0?1:-1;for(let H=1;H<=U;H++)W.push(0,Z*m,0),j++;const cn=j;for(let H=0;H<=U;H++){const en=H/U*L+O,hn=Math.cos(en),gn=Math.sin(en);W[j*3]=J*gn,W[j*3+1]=Z*m,W[j*3+2]=J*hn,j++}for(let H=0;H<U;H++){const rn=R+H,en=cn+H;$===!0?Q.push(en,en+1,rn):Q.push(en+1,en,rn)}}}}class as extends vt{constructor({radius:w=1,widthSegments:A=16,heightSegments:P=8,phiStart:U=0,phiLength:B=Math.PI*2,thetaStart:G=0,thetaLength:O=Math.PI}={}){A=Math.max(3,Math.floor(A)),P=Math.max(2,Math.floor(P));const L=Math.min(G+O,Math.PI);let W=0;const Q=[],j=[],tn=[];for(let Z=0;Z<=P;Z++){const b=[],sn=Z/P;for(let $=0;$<=A;$++){const R=$/A,J=-w*Math.cos(U+R*B)*Math.sin(G+sn*O),m=w*Math.cos(G+sn*O),cn=w*Math.sin(U+R*B)*Math.sin(G+sn*O);j[W*3]=J,j[W*3+1]=m,j[W*3+2]=cn,b.push(W++)}Q.push(b)}for(let Z=0;Z<P;Z++)for(let b=0;b<A;b++){const sn=Q[Z][b+1],$=Q[Z][b],R=Q[Z+1][b],J=Q[Z+1][b+1];(Z!==0||G>0)&&tn.push(sn,$,J),(Z!==P-1||L<Math.PI)&&tn.push($,R,J)}super({vertices:j,indices:tn})}}const Kt=`struct ModelUniforms {\r
  viewProjectionMatrix: mat4x4f,\r
  modelMatrix: mat4x4f,\r
}\r
\r
struct Uniforms {\r
  color: vec4f\r
}\r
\r
@group(0) @binding(0) var<uniform> modelUniforms: ModelUniforms;\r
@group(0) @binding(1) var<uniform> uniforms: Uniforms;\r
\r
struct VertexOutput {\r
  @builtin(position) position: vec4f,\r
}\r
\r
struct VertexInput {\r
  @location(0) position: vec4f,\r
}\r
\r
@vertex\r
fn vertex(\r
  input: VertexInput\r
) -> VertexOutput {\r
  var output: VertexOutput;\r
  \r
  output.position = modelUniforms.viewProjectionMatrix * modelUniforms.modelMatrix * input.position;\r
\r
  return output;\r
}\r
\r
// -------------- //\r
\r
@fragment\r
fn fragment(\r
  input: VertexOutput\r
) -> @location(0) vec4f {\r
  return uniforms.color;\r
}\r
`,mt=`struct ModelUniforms {\r
  viewProjectionMatrix: mat4x4f,\r
}\r
\r
struct Uniforms {\r
  color: vec4f\r
}\r
\r
@group(0) @binding(0) var<uniform> modelUniforms: ModelUniforms;\r
@group(0) @binding(1) var<uniform> uniforms: Uniforms;\r
\r
struct VertexOutput {\r
  @builtin(position) position: vec4f,\r
}\r
\r
struct VertexInput {\r
  @location(0) position: vec4f,\r
  @location(10) model_matrix_row_1: vec4f,\r
  @location(11) model_matrix_row_2: vec4f,\r
  @location(12) model_matrix_row_3: vec4f,\r
  @location(13) model_matrix_row_4: vec4f,\r
}\r
\r
@vertex\r
fn vertex(\r
  input: VertexInput\r
) -> VertexOutput {\r
  var output: VertexOutput;\r
  \r
  let modelMatrix = mat4x4f(\r
    input.model_matrix_row_1,\r
    input.model_matrix_row_2,\r
    input.model_matrix_row_3,\r
    input.model_matrix_row_4,\r
  );\r
\r
  output.position = modelUniforms.viewProjectionMatrix * modelMatrix * input.position;\r
\r
  return output;\r
}\r
\r
// -------------- //\r
\r
@fragment\r
fn fragment(\r
  input: VertexOutput\r
) -> @location(0) vec4f {\r
  return uniforms.color;\r
}\r
`,bt={f32:{size:4,type:Float32Array},i32:{size:4,type:Int32Array},vec3:{size:12,align:16,type:Float32Array},vec4:{size:16,type:Float32Array},mat4:{size:64,align:16,type:Float32Array}};class Ct{constructor(w,A){N(this,"descriptor");N(this,"value");N(this,"buffer");N(this,"offsets",{});let P=0;for(const B in w){const{size:G,align:O,type:L}=bt[w[B]];let W=0;if(O){const Q=P%O;Q>0&&(W=O-Q)}this.offsets[B]={type:L,byteOffset:P+W,length:G/4},P+=G+W}const U=P+(16-P%16);this.value=new ArrayBuffer(U),this.descriptor={label:A,size:this.value.byteLength,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}}set(w){for(const A in w){const P=w[A];if(P){const{type:U,byteOffset:B,length:G}=this.offsets[A];new U(this.value,B,G).set(P)}}}load(w){return this.buffer?this.buffer:(this.buffer=w.createBuffer(this.descriptor),this.buffer)}write(w){const A=this.load(w);kt(w,A,this.value)}}var nt,tt;class ns{constructor({descriptor:w,requiresModelUniforms:A=!0}){fn(this,nt);fn(this,tt,new WeakMap);N(this,"uniformBuffer");N(this,"requiresModelUniforms");on(this,nt,w),this.requiresModelUniforms=A}load(w){let A=X(this,tt).get(w);return A||(A=w.createShaderModule(X(this,nt)),X(this,tt).set(w,A)),this.uniformBuffer&&this.uniformBuffer.write(w),{shaderModule:A,uniformBuffer:this.uniformBuffer}}}nt=new WeakMap,tt=new WeakMap;class fs extends ns{constructor(w,{instanced:A=!1}={}){super({descriptor:{label:"Color Shader",code:A?mt:Kt}}),this.uniformBuffer=new Ct({color:"vec4"},"Color Material Buffer"),this.uniformBuffer.set({color:dt.fromCssString(w).value})}}function hs({canvas:f,device:w,onResize:A}){new ResizeObserver(U=>{for(const B of U)if(B.target instanceof HTMLCanvasElement){const G=B.contentBoxSize[0].inlineSize,O=B.contentBoxSize[0].blockSize,{maxTextureDimension2D:L}=w.limits;f.width=Math.max(1,Math.min(G,L)),f.height=Math.max(1,Math.min(O,L)),A==null||A(B.target)}}).observe(f)}var Gn,st,et,Nn,ot;class ws{constructor({eventSource:w,camera:A,distance:P=5,rotationSpeed:U=5e-4,zoomSpeed:B=.1,frictionCoefficient:G=.01}){fn(this,Gn);N(this,"input",{touching:!1,zoom:0,x:0,y:0});N(this,"position",K.create(0,0,0));N(this,"distance");fn(this,st);fn(this,et);N(this,"frictionCoefficient");fn(this,Nn,0);fn(this,ot,K.create());on(this,Gn,A),this.distance=P,on(this,st,U),on(this,et,B),this.frictionCoefficient=G,w.oncontextmenu=()=>!1,w.onpointermove=O=>{const L=O.buttons===2;O.buttons===1?(this.input.x+=O.movementX,this.input.y+=O.movementY):L&&(this.position=K.add(this.position,K.create(-O.movementX*.25,O.movementY*.25,0)))},w.onwheel=O=>{this.input.zoom+=Math.sign(O.deltaY)}}update(w){this.input.touching?on(this,Nn,0):on(this,Nn,X(this,Nn)*Math.pow(1-this.frictionCoefficient,w));const P=K.create();K.addScaled(P,X(this,Gn).right,-this.input.x,P),K.addScaled(P,X(this,Gn).up,this.input.y,P);const U=K.cross(P,X(this,Gn).front),B=K.len(U);B>1e-7&&(on(this,ot,K.scale(U,1/B)),on(this,Nn,B*X(this,st)));const G=X(this,Nn)*w;G>1e-7&&(X(this,Gn).front=K.normalize(K.transformMat4Upper3x3(X(this,Gn).front,Zn.rotation(X(this,ot),G)))),this.input.zoom!==0&&(this.distance*=1+this.input.zoom*X(this,et)),X(this,Gn).position=K.scale(X(this,Gn).front,-this.distance),X(this,Gn).translate(this.position),this.input.x=0,this.input.y=0,this.input.zoom=0,this.input.touching=!1}}Gn=new WeakMap,st=new WeakMap,et=new WeakMap,Nn=new WeakMap,ot=new WeakMap;var ct;class ls{constructor(w=[],{depth:A=!0}={}){N(this,"children",[]);fn(this,ct);this.add(w),on(this,ct,A)}add(w){Array.isArray(w)||(w=[w]),this.children.push(...w)}remove(w){const A=this.children.indexOf(w);A>=0&&this.children.splice(A,1)}async load(w){const A=[];for(const P of this.children)A.push(P.load(w,{depth:X(this,ct)}));await Promise.all(A)}render(w){for(const A of this.children)A.render(w)}update(w,A){const{viewProjectionMatrix:P}=A??{};for(const U of this.children)U.update(w,P)}}ct=new WeakMap;export{ws as A,os as C,vt as G,ns as M,Ht as O,is as R,ls as S,Jt as T,Ct as U,hs as a,fs as b,us as c,rs as d,as as e,dt as f,cs as i,K as v};
