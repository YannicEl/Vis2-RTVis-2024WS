var S=Object.defineProperty;var B=t=>{throw TypeError(t)};var j=(t,r,e)=>r in t?S(t,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[r]=e;var y=(t,r,e)=>j(t,typeof r!="symbol"?r+"":r,e),w=(t,r,e)=>r.has(t)||B("Cannot "+e);var i=(t,r,e)=>(w(t,r,"read from private field"),e?e.call(t):r.get(t)),f=(t,r,e)=>r.has(t)?B("Cannot add the same private member more than once"):r instanceof WeakSet?r.add(t):r.set(t,e),l=(t,r,e,n)=>(w(t,r,"write to private field"),n?n.call(t,e):r.set(t,e),e);import{O,U}from"./Scene.D-IVrs4_.js";var s,d,a,h,o;class D extends O{constructor(e,n,p){super();f(this,s);f(this,d);y(this,"textures");f(this,a);f(this,h);f(this,o);l(this,s,e),l(this,d,n),this.textures=p,n.requiresModelUniforms&&l(this,o,new U({viewProjectionMatrix:"mat4",modelMatrix:"mat4"},"SceneObject Model Uniform Buffer"))}async load(e,{depth:n}={}){var x,g;const{shaderModule:p,uniformBuffer:m}=i(this,d).load(e);i(this,s).load(e),(x=i(this,o))==null||x.load(e);const b={label:"SceneObject Render Pipeline",layout:"auto",vertex:{module:p,buffers:[{arrayStride:4*3,attributes:[{shaderLocation:0,offset:0,format:"float32x3"}]}]},fragment:{module:p,targets:[{format:navigator.gpu.getPreferredCanvasFormat()}]},primitive:{topology:"triangle-list",cullMode:"back"}};n&&(b.depthStencil={depthWriteEnabled:!0,depthCompare:"less",format:"depth24plus"}),l(this,a,await e.createRenderPipelineAsync(b));const u=[];if((g=i(this,o))!=null&&g.buffer&&u.push({binding:0,resource:{buffer:i(this,o).buffer}}),m!=null&&m.buffer&&u.push({binding:1,resource:{buffer:m.buffer}}),this.textures){u.push({binding:2,resource:e.createSampler({magFilter:"linear"})});for(let c=0;c<this.textures.length;c++)u.push({binding:3+c,resource:this.textures[c].createView(e)})}const G=e.createBindGroupLayout({entries:[]}),M={label:"Uniform Bind Group",layout:u.length?i(this,a).getBindGroupLayout(0):G,entries:u};l(this,h,e.createBindGroup(M))}update(e,n){i(this,o)&&(i(this,o).set({viewProjectionMatrix:n,modelMatrix:this.modelMatrix}),i(this,o).write(e))}render(e){if(!i(this,a)||!i(this,h)||!i(this,s).vertexBuffer||!i(this,s).indexBuffer)throw new Error("SceneObject not loaded");e.setPipeline(i(this,a)),e.setBindGroup(0,i(this,h)),e.setVertexBuffer(0,i(this,s).vertexBuffer),e.setIndexBuffer(i(this,s).indexBuffer,"uint32"),e.drawIndexed(i(this,s).indices.length)}}s=new WeakMap,d=new WeakMap,a=new WeakMap,h=new WeakMap,o=new WeakMap;export{D as S};
